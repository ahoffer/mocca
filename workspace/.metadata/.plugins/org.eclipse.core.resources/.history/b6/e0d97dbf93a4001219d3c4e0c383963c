package weka.subspaceClusterer;

public class MoccaSubspace {

    private boolean[] subspace;
    private int numDims, numCongregatingDims;
    private double[][] discrimObjs;
    private double width;
    private double[] lower;
    private double[] upper;

    public MoccaSubspace(double[][] discrimObjs, double width, int numDims) {
        this.discrimObjs = discrimObjs;
        this.width = width;
        this.numDims = numDims;
        lower = new double[numDims];
        upper = new double[numDims];
    }

    public void eval() {

        double sheath = 0;

        /*
         * Create max and min values in each dimension from the discriminating set. Find the subspace and number of
         * congregating dimensions
         */
        double[] minimums = MoccaUtils.min(discrimObjs);
        double[] maximums = MoccaUtils.max(discrimObjs);
        double lengths[] = MoccaUtils.subtract(maximums, minimums);

        subspace = MoccaUtils.lessThanOrEqualTo(lengths, width);
        numCongregatingDims = MoccaUtils.countTrueValues(getSubspace());

        /*
         * If the entire subspace is zero, it means the discriminating set does not congregate in any dimension. The
         * trial has failed to find a cluster
         */
        if (numCongregatingDims > 0) {

            /*
             * Calculate upper and lower bounds of the hyper volume that surrounds the cluster.
             */

            for (int i = 0; i < numDims; ++i) {

                // DEBUG
                /*
                 * Caused by: java.lang.ArrayIndexOutOfBoundsException: 19
                 * 
                 * MoccaSubspace.eval(MoccaSubspace.java:48)
                 */
                try {
                    sheath = width - lengths[i];
                    lower[i] = minimums[i] - sheath;
                    upper[i] = maximums[i] + sheath;

                } catch (Exception e) {
                    System.err.println("\nWhy this is this happening?");
                    System.err.println(System.nanoTime() / 1000.0);
                    System.err.printf("i=%d, lengths.length=%d\n", i, lengths.length);
                }
            }

        }// if
    }// method

    /**
     * @return the subspace
     */
    public boolean[] getSubspace() {

        return subspace.clone();
    }

    /**
     * @return the lower
     */
    public double[] getLower() {
        return lower.clone();
    }

    /**
     * @return the upper
     */
    double[] getUpper() {
        return upper.clone();
    }

    public int getNumCongregatingDims() {
        return numCongregatingDims;
    }

}
