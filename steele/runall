#!/bin/bash
#First argument is the number jobs
#Second argument is the slot limt

LAST=$(($1 - 1))
START=0
SLOTLIMIT=$2
STOP=$((SLOTLIMIT-1))
RUNNING=0
JOB="/home/hoffer/donothing"

#DEBUG
echo "Before loop $JOB $START $STOP"

while [ "$STOP" -lt "$LAST" ] 
do
  #DEBUG
  echo "Top of loop start=$START, stop=$STOP, num running=$RUNNING"

  if [ $RUNNING -lt "$SLOTLIMIT" ]
  then
    STOP=$((START+1))
    echo "  Submitting $START $STOP"
    $JOB $START $STOP
    START=$STOP
  else 
    echo "sleeping..."
    sleep 2
  fi
  OUTPUT=$(qstat -u hoffer)
  LINES=$($OUTPUT | wc -l)
  
  if [ $LINES -eq 0 ] 
  then 
    RUNNING=0
  else
    RUNNING= RUNNING=$((LINES-6))
  fi

  #DEBUG
  echo "Lines $LINES, Running $RUNNING"
  
  
done
